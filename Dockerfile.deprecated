FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"="\
"dmVyc2lvbjogMS4wCm5hbWU6IHN0YW5kYWxvbmUtY2luZGVyLWFwYgpkZXNjcmlwdGlvbjogQVBC\
IHRvIGRlcGxveSBTdGFuZGFsb25lIENpbmRlcgpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlv\
bmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBzdGFuZGFsb25lLWNpbmRlcgogIGRlcGVuZGVu\
Y2llczogW10KcGxhbnM6CiAgLSBuYW1lOiBjZXBoCiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFu\
IGRlcGxveXMgc3RhbmRhbG9uZS1jaW5kZXIgd2l0aCBDZXBoIGJhY2tlbmQKICAgIHBhcmFtZXRl\
cnM6IAogICAgICAtIHRpdGxlOiBDaW5kZXIgUG9vbCBOYW1lCiAgICAgICAgbmFtZTogY2luZGVy\
X3ZvbHVtZXMKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAtIHRpdGxlOiBDaW5kZXIgVXNlciBOYW1lCiAgICAgICAgbmFtZTogY2luZGVyX3JiZF91c2Vy\
X25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAt\
IHRpdGxlOiBDaW5kZXIgQ2xpZW50IEtleQogICAgICAgIG5hbWU6IGNpbmRlcl9rZXkKICAgICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBDaW5k\
ZXIgTW9uaXRvciBIb3N0CiAgICAgICAgbmFtZTogY2luZGVyX21vbl9ob3N0CiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFk\
YXRhOiB7fQogIC0gbmFtZTogeHRyZW1pbwogICAgZGVzY3JpcHRpb246IFRoaXMgcGxhbiBkZXBs\
b3lzIHN0YW5kYWxvbmUtY2luZGVyIHdpdGggWHRyZW1pbyBiYWNrZW5kCiAgICBmcmVlOiBUcnVl\
CiAgICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6IAogICAgICAtIHRpdGxlOiBYdHJlbWlv\
IFNBTiBJUAogICAgICAgIG5hbWU6IHNhbl9pcAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFh0cmVtaW8gU0FOIExvZ2luCiAgICAgICAg\
bmFtZTogc2FuX2xvZ2luCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRy\
dWUKICAgICAgLSB0aXRsZTogWHRyZW1pbyBTQU4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBzYW5f\
cGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQo="

COPY requirements.yml /opt/ansible/requirements.yml
RUN ansible-galaxy install -r /opt/ansible/requirements.yml
ADD playbooks /opt/apb/actions
ADD roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
